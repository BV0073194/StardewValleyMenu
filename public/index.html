<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B's Stardew Valley Modding Menu</title>
    <link rel="stylesheet" href="https://stardewmenu-bxh8fzbpacfrfhdx.westus2-01.azurewebsites.net/style.css">
</head>
<body>

<div class="container">
    <h1>Stardew Valley Item Spawner</h1>

    <div class="spawn-form">
        <label for="quantity">Quantity:</label>
        <input type="number" id="quantity" name="quantity" value="1" min="1">
    </div>

    <!-- Filter Options -->
    <div class="filters">
        <select id="category-filter">
            <option value="all">All Categories</option>
            <option value="Tool">Tool</option>
            <option value="Item">Item</option>
        </select>

        <select id="rarity-filter">
            <option value="all">All Rarities</option>
            <option value="None">None</option>
            <option value="Common">Common</option>
            <option value="Uncommon">Uncommon</option>
            <option value="Rare">Rare</option>
            <option value="Legendary">Legendary</option>
            <option value="Mythic">Mythic</option>
        </select>
    </div>

    <!-- Item List -->
    <div class="item-list" id="item-list"></div>
</div>

<script>
let itemData = [];

async function fetchItemList() {
    try {
        const response = await fetch('https://stardewmenu-bxh8fzbpacfrfhdx.westus2-01.azurewebsites.net/info.json');
        if (response.ok) {
            const data = await response.json();
            itemData = data.items;  // Store items globally
            renderItems(itemData);
        } else {
            console.error('Failed to load item list:', response.statusText);
        }
    } catch (error) {
        console.error('Error fetching item list:', error);
    }
}

// Render items based on fetched data and filters
function renderItems(items) {
    const itemList = document.getElementById('item-list');
    itemList.innerHTML = '';  // Clear current list

    items.forEach(item => {
        const itemCard = document.createElement('div');
        itemCard.classList.add('item-card');
        itemCard.dataset.category = item.category;
        itemCard.dataset.rarity = item.rarity;
        itemCard.dataset.id = item.id;

        itemCard.innerHTML = `
            <img src="${item.image}" alt="${item.name}">
            <p>${item.name}</p>
        `;

        itemCard.addEventListener('click', () => {
            const quantity = document.getElementById('quantity').value;
            window.location.href = `/?item=${item.id}&quantity=${quantity}`;
        });

        itemList.appendChild(itemCard);
    });

    filterItems();  // Apply filtering immediately after rendering
}

// Filtering logic
const categoryFilter = document.getElementById('category-filter');
const rarityFilter = document.getElementById('rarity-filter');

function filterItems() {
    const selectedCategory = categoryFilter.value;
    const selectedRarity = rarityFilter.value;

    document.querySelectorAll('.item-card').forEach(card => {
        const matchesCategory = selectedCategory === 'all' || card.dataset.category === selectedCategory;
        const matchesRarity = selectedRarity === 'all' || card.dataset.rarity === selectedRarity;

        card.style.display = (matchesCategory && matchesRarity) ? 'block' : 'none';
    });
}

// Event Listeners for Filter Changes
categoryFilter.addEventListener('change', filterItems);
rarityFilter.addEventListener('change', filterItems);

// Fetch and refresh item list every 5 seconds
setInterval(fetchItemList, 5000);
fetchItemList();  // Initial fetch on page load
</script>

</body>
</html>