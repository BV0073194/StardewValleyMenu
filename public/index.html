<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B's Modding Menu - v1.0.0 (SMAPI)</title>
    
    <!-- Bootstrap CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="https://stardewmenu-bxh8fzbpacfrfhdx.westus2-01.azurewebsites.net/style.css">
    
    <!-- Favicon -->
    <link rel="shortcut icon" href="https://stardewvalleywiki.com/mediawiki/extensions/StardewValley/images/favicon.png">
  </head>

  <body>
    <div class="container my-5 p-4 rounded shadow">
      <h1 class="mb-4">B's Modding Menu : v1.0.0 (SMAPI)</h1>
      
      <div class="spawn-form mb-4">
        <label for="quantity" class="form-label">Quantity:</label>
        <input type="number" id="quantity" name="quantity" class="form-control mx-auto w-auto" value="1" min="1">
      </div>
      
      <!-- Filter Options -->
      <div class="filters mb-4 d-flex flex-wrap justify-content-center gap-3">
        <select id="category-filter" class="form-select w-auto">
          <option value="all">All Categories</option>
          <option value="Tool">Tool</option>
          <option value="Item">Item</option>
          <option value="Decoration">Decoration</option>
          <option value="Misc">Misc</option>
        </select>
        
        <select id="rarity-filter" class="form-select w-auto">
          <option value="all">All Rarities</option>
          <option value="None">None</option>
          <option value="Common">Common</option>
          <option value="Uncommon">Uncommon</option>
          <option value="Rare">Rare</option>
          <option value="Legendary">Legendary</option>
          <option value="Mythic">Mythic</option>
        </select>
      </div>

      <!-- Item List -->
      <div class="item-list" id="item-list">
        <!-- Items will be dynamically added -->
      </div>
    </div>
    
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const itemList = document.getElementById('item-list');
        itemList.style.gap = '15px';

        // Restore filters from localStorage
        const savedCategory = localStorage.getItem('categoryFilter') || 'all';
        const savedRarity = localStorage.getItem('rarityFilter') || 'all';
        
        document.getElementById('category-filter').value = savedCategory;
        document.getElementById('rarity-filter').value = savedRarity;
        
        filterItems();
      });
    </script>

    <script>
      let itemData = [];
      
      async function fetchItemList() {
        try {
          const response = await fetch('https://stardewmenu-bxh8fzbpacfrfhdx.westus2-01.azurewebsites.net/info.json');
          if (response.ok) {
            const data = await response.json();
            itemData = data.items;
            renderItems(itemData);
          } else {
            console.error('Failed to load item list:', response.statusText);
          }
        } catch (error) {
          console.error('Error fetching item list:', error);
        }
      }

      function renderItems(items) {
        const itemList = document.getElementById('item-list');
        itemList.innerHTML = '';

        items.forEach(item => {
          const itemCard = document.createElement('div');
          itemCard.classList.add('item-card');

          itemCard.dataset.category = item.category;
          itemCard.dataset.rarity = item.rarity;
          itemCard.dataset.id = item.id;

          itemCard.innerHTML = `
            <img src="${item.image}" alt="${item.name}">
            <p>${item.name}</p>
          `;

          itemCard.addEventListener('click', () => {
            const quantity = document.getElementById('quantity').value;
            const itemId = item.id;
            // Send give item command without reloading
            fetch(`./give?item=${itemId}&quantity=${quantity}`)
              .then(response => {
                if (response.ok) {
                  return;
                } else {
                  alert('Failed to add item.');
                }
              });
          });

          itemList.appendChild(itemCard);
        });

        filterItems();
      }

      function filterItems() {
        const selectedCategory = document.getElementById('category-filter').value;
        const selectedRarity = document.getElementById('rarity-filter').value;

        document.querySelectorAll('.item-card').forEach(card => {
          const matchesCategory = selectedCategory === 'all' || card.dataset.category === selectedCategory;
          const matchesRarity = selectedRarity === 'all' || card.dataset.rarity === selectedRarity;
          
          card.style.display = (matchesCategory && matchesRarity) ? 'block' : 'none';
        });

        // Save filters to localStorage
        localStorage.setItem('categoryFilter', selectedCategory);
        localStorage.setItem('rarityFilter', selectedRarity);
      }

      document.getElementById('category-filter').addEventListener('change', filterItems);
      document.getElementById('rarity-filter').addEventListener('change', filterItems);
      
      setInterval(fetchItemList, 5000);
      fetchItemList();
    </script>
  </body>
</html>
